"use strict";(self.webpackChunkiobroker_admin_component_ping=self.webpackChunkiobroker_admin_component_ping||[]).push([["src_Components_jsx"],{66393:(O,S,d)=>{d.r(S),d.d(S,{default:()=>j});var w=d(28437),s=d.n(w),E=d(95973),f=d.n(E),l=d(67085),C=d(21839),h=d(37449),k=d(60556),_=Object.defineProperty,I=Object.getPrototypeOf,$=Reflect.get,T=(g,t,i)=>t in g?_(g,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):g[t]=i,x=(g,t,i)=>T(g,typeof t!="symbol"?t+"":t,i),L=(g,t,i)=>$(I(g),i,t),m=(g,t,i)=>new Promise((r,a)=>{var c=n=>{try{e(i.next(n))}catch(o){a(o)}},u=n=>{try{e(i.throw(n))}catch(o){a(o)}},e=n=>n.done?r(n.value):Promise.resolve(n.value).then(c,u);e((i=i.apply(g,t)).next())});function y(g){const t=g.split(".").map(r=>parseInt(r,10).toString(2));if(t.length!==4)return 0;const i=t.join("").split("1").length-1;return Math.pow(2,32-i)}class v extends k.ConfigGeneric{constructor(t){super(t),x(this,"onChangedState",(i,r)=>{if(i.endsWith(".alive")){const a=r?r.val:!1;a!==this.state.alive&&this.setState({alive:a})}else if(i.endsWith(".progress")){const a=r?r.val:0;a!==this.state.progress&&this.setState({progress:a})}else if(i.endsWith(".running")){const a=!!(r!=null&&r.val);a!==this.state.running&&this.setState({running:a})}else if(i.endsWith(".result")){const a=(r==null?void 0:r.val)||"[]";a!==JSON.stringify(this.state.ips)&&this.setState({ips:JSON.parse(a)})}else if(i.endsWith(".status")){const a=(r==null?void 0:r.val)||"";a!==this.state.status&&this.setState({status:a})}else if(i.endsWith(".rangeStart")){const a=(r==null?void 0:r.val)||"";a!==this.state.rangeStart&&this.setState({rangeStart:a})}else if(i.endsWith(".rangeLength")){const a=(r==null?void 0:r.val)||"";a!==this.state.rangeLength&&this.setState({rangeLength:a})}else if(i.endsWith(".interface")){const a=(r==null?void 0:r.val)||"";a&&a!==this.state.interface&&this.state.interfaces.find(c=>c.ip===a)&&this.setState({interface:a})}}),this.state={alive:!1,progress:0,interface:"",interfaces:[],selected:[],ips:[],running:!1,status:""}}getAllInterfaces(){return m(this,null,function*(){var t,i;const r=[],a=yield this.props.socket.getObject(`system.adapter.ping.${this.props.instance}`),c=yield this.props.socket.getObject(`system.host.${a.common.host}`);return(i=(t=c==null?void 0:c.native)==null?void 0:t.hardware)!=null&&i.networkInterfaces&&Object.keys(c.native.hardware.networkInterfaces).forEach(u=>{c.native.hardware.networkInterfaces[u].forEach(n=>{n.family==="IPv4"&&!n.internal&&r.push({name:u,ip:n.address,netmask:n.netmask})})}),r})}componentDidMount(){return m(this,null,function*(){yield L(v.prototype,this,"componentDidMount").call(this);const t={},i=yield this.props.socket.getState(`system.adapter.ping.${this.props.instance}.alive`);t.alive=!!(i!=null&&i.val);const r=yield this.props.socket.getState(`ping.${this.props.instance}.browse.interface`),a=yield this.props.socket.getState(`ping.${this.props.instance}.browse.progress`),c=yield this.props.socket.getState(`ping.${this.props.instance}.browse.running`),u=yield this.props.socket.getState(`ping.${this.props.instance}.browse.result`),e=yield this.props.socket.getState(`ping.${this.props.instance}.browse.status`),n=yield this.props.socket.getState(`ping.${this.props.instance}.browse.rangeStart`),o=yield this.props.socket.getState(`ping.${this.props.instance}.browse.rangeLength`);t.status=(e==null?void 0:e.val)||"",t.progress=(a==null?void 0:a.val)||0,t.running=!!(c!=null&&c.val),t.rangeStart=(n==null?void 0:n.val)||"",t.rangeLength=(o==null?void 0:o.val)||"";try{t.ips=JSON.parse(u==null?void 0:u.val)||[],t.ips[0]&&typeof t.ips=="string"&&(t.ips=t.ips.map(p=>({ip:p})))}catch(p){t.ips=[]}yield this.props.socket.subscribeState(`system.adapter.ping.${this.props.instance}.alive`,this.onChangedState),yield this.props.socket.subscribeState(`ping.${this.props.instance}.browse.*`,this.onChangedState),t.interfaces=yield this.getAllInterfaces(),t.interfaces.find(p=>p.ip===(r==null?void 0:r.val))&&(t.interface=r==null?void 0:r.val),this.setState(t)})}browse(){const t=this.state.interfaces.find(i=>i.ip===this.state.interface);t.rangeStart=this.state.rangeStart,t.rangeLength=this.state.rangeLength,this.props.socket.sendTo(`ping.${this.props.instance}`,"ping:settings:browse",t).catch(i=>console.error(`Cannot ping: ${i}`))}componentWillUnmount(){return m(this,null,function*(){yield this.props.socket.unsubscribeState(`system.adapter.ping.${this.props.instance}.alive`,this.onChangedState),yield this.props.socket.unsubscribeState(`ping.${this.props.instance}.browse.*`,this.onChangedState)})}renderItem(){if(!this.state.interfaces)return s().createElement(l.LinearProgress,null);const t=this.props.data.devices||[],i=this.state.ips.filter(e=>!t.find(n=>n.ip===e.ip)),r=i.length===this.state.selected.length,a=this.state.interfaces.find(e=>e.ip===this.state.interface);let c=0;a&&(c=y(a.netmask));const u=s().createElement(l.Button,{style:{marginLeft:c>256?0:16,whiteSpace:"nowrap",width:250},variant:"contained",disabled:!this.state.alive||!this.state.interface,onClick:()=>{this.state.running?this.props.socket.setState(`ping.${this.props.instance}.browse.running`,!1):this.browse()},startIcon:s().createElement(C.Search,null)},s().createElement("span",{style:{marginLeft:8}},this.state.running?`${this.state.status} ${h.I18n.t("custom_ping_stop")}`:h.I18n.t("custom_ping_browse")));return s().createElement("div",{style:{width:"100%"},className:"ping_custom"},s().createElement("h4",null,h.I18n.t("custom_ping_title")),s().createElement("div",{style:{width:"100%",display:"flex",alignItems:"center"}},s().createElement(l.FormControl,{style:{width:"100%",maxWidth:600},variant:"standard"},s().createElement(l.InputLabel,null,h.I18n.t("custom_ping_interface")),s().createElement(l.Select,{variant:"standard",disabled:this.state.running,value:this.state.interface,onChange:e=>{let n="",o="";const p=this.state.interfaces.find(b=>b.ip===e.target.value);if(p&&y(p.netmask)>256){const b=p.ip.split(".");b[3]="1",n=b.join("."),o=254}this.setState({interface:e.target.value,rangeStart:n,rangeLength:o},()=>m(this,null,function*(){yield this.props.socket.setState(`ping.${this.props.instance}.browse.interface`,this.state.interface),yield this.props.socket.setState(`ping.${this.props.instance}.browse.rangeStart`,this.state.rangeStart),yield this.props.socket.setState(`ping.${this.props.instance}.browse.rangeLength`,this.state.rangeLength)}))}},s().createElement(l.MenuItem,{value:""},s().createElement("em",null,h.I18n.t("custom_ping_select_interface"))),this.state.interfaces.map(e=>{const n=y(e.netmask);return s().createElement(l.MenuItem,{key:e.ip,value:e.ip},`${e.name} - ${e.ip} (${n} ${h.I18n.t("custom_ping_ips")})`)}))),c>256?s().createElement(l.TextField,{variant:"standard",style:{marginLeft:8,width:300},label:h.I18n.t("custom_ping_range_begin"),value:this.state.rangeStart,onChange:e=>{this.setState({rangeStart:e.target.value},()=>m(this,null,function*(){yield this.props.socket.setState(`ping.${this.props.instance}.browse.rangeStart`,this.state.rangeStart)}))},disabled:this.state.running}):null,c>256?s().createElement(l.TextField,{variant:"standard",style:{marginLeft:8,width:150},label:h.I18n.t("custom_ping_range_length"),value:this.state.rangeLength,onChange:e=>{this.setState({rangeLength:e.target.value},()=>m(this,null,function*(){yield this.props.socket.setState(`ping.${this.props.instance}.browse.rangeLength`,this.state.rangeLength)}))},type:"number",slotProps:{htmlInput:{min:1,max:254}},disabled:this.state.running}):null,c<=256?u:null),c>256?s().createElement("div",{style:{width:"100%",marginTop:10,margigBottom:10}},u):null,this.state.running?s().createElement(l.LinearProgress,{value:this.state.progress/255*100,variant:"determinate"}):s().createElement("div",{style:{height:4}}),s().createElement(l.Button,{variant:"contained",style:{marginTop:10,marginBottom:10},disabled:!this.state.selected.length,onClick:()=>{const e=[...this.props.data.devices];this.state.selected.forEach(o=>{e.find(p=>p.ip===o)||e.push({ip:o,name:o})});const n=JSON.parse(JSON.stringify(this.props.data));n.devices=e,e.sort((o,p)=>o.ip>p.ip?1:o.ip<p.ip?-1:0),this.props.onChange(n),this.setState({selected:[]})}},h.I18n.t("custom_ping_add")),s().createElement(l.TableContainer,{component:l.Paper,style:{width:"100%"}},s().createElement(l.Table,{style:{width:"100%"},size:"small"},s().createElement(l.TableHead,null,s().createElement(l.TableRow,{style:{background:this.props.themeType==="dark"?"#333":"#DDD"}},s().createElement(l.TableCell,{style:{height:55}},i.length?s().createElement(l.Checkbox,{title:h.I18n.t("custom_ping_select_all"),disabled:!i.length,indeterminate:!r&&this.state.selected.length,checked:r,onClick:()=>{r?this.setState({selected:[]}):this.setState({selected:i})}}):null),s().createElement(l.TableCell,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",height:55}},h.I18n.t("custom_ping_ip")),s().createElement(l.TableCell,null,h.I18n.t("custom_ping_mac")),s().createElement(l.TableCell,null,h.I18n.t("custom_ping_vendor")),s().createElement(l.TableCell,null,h.I18n.t("custom_ping_ignore")))),s().createElement(l.TableBody,null,this.state.ips.map(e=>s().createElement(l.TableRow,{key:e.ip,sx:{"&:last-child td, &:last-child th":{border:0}}},s().createElement(l.TableCell,{component:"th",scope:"row"},t.find(n=>n.ip===e.ip)?null:s().createElement(l.Checkbox,{checked:this.state.selected.includes(e.ip),style:{padding:"0 8px"},onChange:()=>{const n=this.state.selected,o=n.indexOf(e.ip);o===-1?n.push(e.ip):n.splice(o,1),this.setState({selected:n})}})),s().createElement(l.TableCell,null,e.ip),s().createElement(l.TableCell,null,e.mac),s().createElement(l.TableCell,null,e.vendor),s().createElement(l.TableCell,null,t.find(n=>n.ip===e.ip)?null:s().createElement(l.Checkbox,{checked:e.ignore,style:{padding:"0 8px"},onChange:()=>{const n=[...this.state.ips],o=n.find(p=>p.ip===e.ip);o&&(o.ignore=!o.ignore,this.setState({ips:n},()=>this.props.socket.setState(`ping.${this.props.instance}.browse.result`,JSON.stringify(n),!1)))}}))))))))}}v.propTypes={socket:f().object.isRequired,themeType:f().string,themeName:f().string,style:f().object,data:f().object.isRequired,attr:f().string,schema:f().object,onError:f().func,onChange:f().func};const j={PingBrowseComponent:v}}}]);

//# sourceMappingURL=src_Components_jsx.f6211d2a.chunk.js.map